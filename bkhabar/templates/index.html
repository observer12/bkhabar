{% extends 'base.html' %}

{% block extra_head %}
<style>
  /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
  .hero {
    background: linear-gradient(135deg, var(--dark) 0%, #3D1A00 60%, var(--saffron) 100%);
    padding: 4rem 1.5rem;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 70% 50%, rgba(232,96,44,.3) 0%, transparent 60%);
  }
  .hero-tag {
    display: inline-block;
    background: var(--saffron);
    color: var(--white);
    padding: .3rem 1rem;
    border-radius: 50px;
    font-size: .85rem;
    font-weight: 600;
    margin-bottom: 1rem;
    letter-spacing: 1px;
  }
  .hero h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.2rem, 5vw, 3.8rem);
    color: var(--white);
    line-height: 1.15;
    margin-bottom: .8rem;
  }
  .hero h1 em {
    color: var(--gold);
    font-style: italic;
  }
  .hero p {
    color: rgba(255,255,255,.75);
    font-size: 1.05rem;
    max-width: 500px;
    margin: 0 auto 2rem;
  }
  .hero-stats {
    display: flex;
    gap: 2rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 2rem;
  }
  .hero-stat {
    text-align: center;
    color: rgba(255,255,255,.8);
    font-size: .9rem;
  }
  .hero-stat strong { display: block; font-size: 1.4rem; color: var(--gold); font-weight: 700; }

  /* ‚îÄ‚îÄ FREE DELIVERY BANNER ‚îÄ‚îÄ */
  .banner {
    background: var(--green);
    color: var(--white);
    text-align: center;
    padding: .6rem 1rem;
    font-size: .9rem;
    font-weight: 600;
  }

  /* ‚îÄ‚îÄ CATEGORY TABS ‚îÄ‚îÄ */
  .categories {
    padding: 1.5rem 0 .5rem;
    overflow-x: auto;
    white-space: nowrap;
    scrollbar-width: none;
  }
  .categories::-webkit-scrollbar { display: none; }
  .cat-tabs { display: inline-flex; gap: .75rem; padding: 0 1.5rem; }
  .cat-tab {
    padding: .5rem 1.2rem;
    border-radius: 50px;
    border: 2px solid var(--light);
    background: var(--white);
    cursor: pointer;
    font-family: 'Hind Siliguri', sans-serif;
    font-size: .9rem;
    font-weight: 600;
    color: var(--mid);
    transition: all .2s;
    white-space: nowrap;
  }
  .cat-tab:hover, .cat-tab.active {
    background: var(--saffron);
    border-color: var(--saffron);
    color: var(--white);
  }

  /* ‚îÄ‚îÄ MENU SECTION ‚îÄ‚îÄ */
  .menu-section {
    padding: 2rem 1.5rem;
    max-width: 1100px;
    margin: 0 auto;
  }
  .section-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.6rem;
    color: var(--dark);
    margin-bottom: 1.2rem;
    padding-bottom: .5rem;
    border-bottom: 3px solid var(--saffron);
    display: inline-block;
  }
  .category-block { margin-bottom: 3rem; }

  /* ‚îÄ‚îÄ MENU GRID ‚îÄ‚îÄ */
  .menu-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.2rem;
  }

  .menu-card {
    background: var(--white);
    border-radius: 16px;
    padding: 1.2rem 1.4rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 2px 12px rgba(0,0,0,.07);
    transition: box-shadow .25s, transform .2s;
    position: relative;
  }
  .menu-card:hover {
    box-shadow: 0 8px 30px rgba(232,96,44,.15);
    transform: translateY(-3px);
  }
  .menu-card-emoji {
    font-size: 2.6rem;
    flex-shrink: 0;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--cream);
    border-radius: 12px;
  }
  .menu-card-info { flex: 1; min-width: 0; }
  .menu-card-name {
    font-weight: 700;
    font-size: 1rem;
    color: var(--dark);
    line-height: 1.3;
  }
  .menu-card-name-bn {
    font-size: .85rem;
    color: var(--mid);
    margin-bottom: .3rem;
  }
  .menu-card-desc {
    font-size: .8rem;
    color: rgba(0,0,0,.5);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .menu-card-bottom {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: .7rem;
  }
  .menu-price {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--saffron);
  }
  .menu-price span { font-size: .8rem; font-weight: 400; color: var(--mid); }

  .add-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--saffron);
    border: none;
    color: var(--white);
    font-size: 1.4rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    transition: all .2s;
    flex-shrink: 0;
  }
  .add-btn:hover { background: var(--deep); transform: scale(1.15) rotate(90deg); }
  .add-btn.added { background: var(--green); }

  .popular-badge {
    position: absolute;
    top: -6px;
    right: 12px;
    background: var(--gold);
    color: var(--dark);
    font-size: .65rem;
    font-weight: 700;
    padding: .15rem .6rem;
    border-radius: 50px;
    text-transform: uppercase;
    letter-spacing: .5px;
  }

  /* ‚îÄ‚îÄ QTY STEPPER in card ‚îÄ‚îÄ */
  .qty-stepper {
    display: flex;
    align-items: center;
    gap: .4rem;
  }
  .qty-stepper button {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 2px solid var(--saffron);
    background: transparent;
    color: var(--saffron);
    font-size: 1.1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all .15s;
  }
  .qty-stepper button:hover { background: var(--saffron); color: var(--white); }
  .qty-stepper span { font-weight: 700; min-width: 20px; text-align: center; }

  /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
  .toast {
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    background: var(--dark);
    color: var(--white);
    padding: .9rem 1.5rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: .95rem;
    transform: translateY(120%);
    transition: transform .3s cubic-bezier(.34,1.56,.64,1);
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: .5rem;
    box-shadow: 0 8px 30px rgba(0,0,0,.3);
  }
  .toast.show { transform: translateY(0); }
</style>
{% endblock %}

{% block content %}

<div class="banner">
  üéâ Free delivery on orders above ‡ß≥500 &nbsp;|&nbsp; ‡ß´‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶â‡¶™‡¶∞‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá ‡¶´‡ßç‡¶∞‡¶ø ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø!
</div>

<!-- HERO -->
<div class="hero">
  <span class="hero-tag">üáßüá© 100% Bangladeshi</span>
  <h1>‡¶Ü‡¶∏‡¶≤ ‡¶∏‡ßç‡¶¨‡¶æ‡¶¶,<br><em>‡¶ò‡¶∞‡ßá ‡¶™‡ßå‡¶Å‡¶õ‡ßá ‡¶¶‡ßá‡¶á</em></h1>
  <p>Authentic Bangladeshi food delivered fresh to your doorstep across Dhaka</p>
  <a href="#menu" class="btn btn-primary" style="font-size:1.1rem">üçΩÔ∏è ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® &nbsp;‚Üí</a>
  <div class="hero-stats">
    <div class="hero-stat"><strong>30+</strong>Menu Items</div>
    <div class="hero-stat"><strong>45 min</strong>Avg Delivery</div>
    <div class="hero-stat"><strong>4.8 ‚≠ê</strong>Rating</div>
  </div>
</div>

<!-- CATEGORY TABS -->
<div class="categories">
  <div class="cat-tabs">
    <button class="cat-tab active" onclick="filterCat('all', this)">üçΩÔ∏è All</button>
    {% for cat in menu.keys() %}
    <button class="cat-tab" onclick="filterCat('{{ cat }}', this)">{{ cat }}</button>
    {% endfor %}
  </div>
</div>

<!-- MENU -->
<div id="menu" class="menu-section">
  {% for category, items in menu.items() %}
  <div class="category-block" data-cat="{{ category }}">
    <div class="section-title">{{ category }}</div>
    <div class="menu-grid">
      {% for item in items %}
      <div class="menu-card" id="card-{{ item.id }}">
        {% if item.popular %}<span class="popular-badge">‚≠ê Popular</span>{% endif %}
        <div class="menu-card-emoji">{{ item.emoji }}</div>
        <div class="menu-card-info">
          <div class="menu-card-name">{{ item.name }}</div>
          <div class="menu-card-name-bn">{{ item.name_bn }}</div>
          <div class="menu-card-desc">{{ item.description }}</div>
          <div class="menu-card-bottom">
            <div class="menu-price">‡ß≥{{ item.price|int }} <span>BDT</span></div>
            <div class="add-controls" id="ctrl-{{ item.id }}">
              <button class="add-btn" onclick="addToCart({{ item.id }}, this)">+</button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endfor %}
</div>

<!-- TOAST -->
<div class="toast" id="toast">üõí Added to cart!</div>

{% endblock %}

{% block scripts %}
<script>
  // Cart state
  const cartQty = {};

  async function addToCart(id, btn) {
    cartQty[id] = (cartQty[id] || 0) + 1;

    const res = await fetch('/api/cart/add', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({id})
    });
    const data = await res.json();
    updateCartBadge(data.cart_count);

    // Show stepper
    showStepper(id, cartQty[id]);
    showToast();
  }

  async function changeQty(id, delta) {
    cartQty[id] = Math.max(0, (cartQty[id] || 0) + delta);
    const res = await fetch('/api/cart/update', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({id, qty: cartQty[id]})
    });
    const data = await res.json();
    updateCartBadge(data.cart_count);

    if (cartQty[id] === 0) {
      document.getElementById('ctrl-' + id).innerHTML =
        `<button class="add-btn" onclick="addToCart(${id}, this)">+</button>`;
    } else {
      document.querySelector(`#ctrl-${id} .qty-stepper span`).textContent = cartQty[id];
    }
  }

  function showStepper(id, qty) {
    document.getElementById('ctrl-' + id).innerHTML = `
      <div class="qty-stepper">
        <button onclick="changeQty(${id}, -1)">‚àí</button>
        <span>${qty}</span>
        <button onclick="changeQty(${id}, +1)">+</button>
      </div>`;
  }

  function showToast() {
    const t = document.getElementById('toast');
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2200);
  }

  function filterCat(cat, btn) {
    document.querySelectorAll('.cat-tab').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.category-block').forEach(block => {
      block.style.display = (cat === 'all' || block.dataset.cat === cat) ? '' : 'none';
    });
  }
</script>
{% endblock %}
